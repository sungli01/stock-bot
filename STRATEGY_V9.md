# Stock-Bot v9 전략 조건 (2026-02-21 확정)

## 후보 필터 (BarScanner 진입)
- 전일 대비 변동률: +5% 이상 ~ +20% 미만
- 가격 범위: $0.70 ~ $30.00

## 1차 상승 조건
- Vol Spike (3분봉): 1000%+ → 모니터링 큐 등록
- 매수 트리거: 큐 등록가 대비 +20% 도달
- 매수량: 큐 등록 ~ +20% 도달 사이 누적 거래량의 30% 이내
- 큐 유효기간: 30분 → 미도달 시 폐기
- 큐 재등록: 폐기 후 Vol Spike 재발생 시 새 가격으로 재등록
- 일 거래량: 무제한

## 2차 상승 조건
- 진입 조건: 동일 종목 1차 매수 완료 후
- Vol Spike (3분봉): 200%+ → 모니터링 큐 등록
- 가격 범위: 무제한
- 일 거래량: 무제한
- 매수 트리거: 큐 등록가 대비 +15% 도달
- 매수량: 풀 매수
- 큐 유효기간: 30분

## 공통 규칙
- 동일 종목 일 최대 매수: 2회 (1차 1회 + 2차 1회)
- 2회 소진 후 당일 재매수 차단

## 매도 조건 (1·2차 공통)
- 하드 손절: -7%
- 트레일링 활성화: +8% 도달 시
- 트레일링 폭:
  - +8~15%: -3%p
  - +15~50%: -5%p
  - +50~80%: -8%p
  - +80%+: -30%p
- 시간 가중치: 30분 경과 후 트레일링 폭 ×0.8
- 최대 보유: 120분
- 장 마감 전 15분 강제 청산

## 수정이 필요한 버그 목록
1. [치명] 큐 만료 버그: bar_scanner._scan()에서 candidates 없으면 early return → 만료 cleanup 미실행
   → _scan() 시작부에서 만료 cleanup 먼저 실행하도록 수정
2. [중요] 상단 진입 제한: 큐 등록가 대비 +40% 초과 시 매수 금지 추가
3. [중요] 워런트(.WS) 종목 미필터: ETF 필터에 .WS 패턴 추가
4. [보통] paper_trader 주수 계산 오류: KRW→USD 환율 미적용
5. [신규] candidate_change_pct: 5%+ 단방향 → 5%~20% 범위
6. [신규] vol_3min_ratio_pct: 1000% (1차) / 200% (2차 별도)
7. [신규] max_hold_minutes: 45 → 120분
8. [신규] 1차/2차 상승 구분 로직 (traded_tickers 카운트 기반)
9. [신규] 매수량: 누적 거래량 30% 이내 동적 조절
